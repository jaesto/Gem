<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self' blob:; script-src 'self'; style-src 'self'; img-src 'self' data:; font-src 'self'; connect-src 'self';"
    />
    <title>Tableau Workbook Explorer</title>
    <link rel="icon" type="image/svg+xml"
      href="data:image/svg+xml;utf8,
      <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 256 256'>
        <rect width='256' height='256' rx='56' fill='%230E0B14'/>
        <path d='M128 24 L224 80 V176 L128 232 L32 176 V80 Z' fill='%238B5CF6'/>
        <path d='M128 24 L224 80 L128 176 L32 80 Z' fill='%23A78BFA' opacity='.45'/>
      </svg>">
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header class="toolbar topbar">
      <div class="toolbar-left">
        <a class="brand" href="./" aria-label="Gem home">
          <span class="brand-logo" aria-hidden="true">
            <svg width="28" height="28" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="g1" x1="0" x2="1" y1="0" y2="1">
                  <stop offset="0%" stop-color="#A78BFA" /><stop offset="100%" stop-color="#6D28D9" />
                </linearGradient>
              </defs>
              <rect width="256" height="256" rx="28" fill="#0E0B14" />
              <path d="M128 20 L236 82 V174 L128 236 L20 174 V82 Z" fill="url(#g1)" />
              <path d="M128 20 L236 82 L128 128 L20 82 Z" fill="#8B5CF6" opacity=".35" />
              <path d="M128 128 L236 82 V174 L128 236 Z" fill="#6D28D9" opacity=".45" />
              <path d="M128 128 L20 82 V174 L128 236 Z" fill="#C084FC" opacity=".25" />
            </svg>
          </span>
          <span class="brand-name">Gem</span>
        </a>
        <button class="btn" id="openBtn" type="button">Open Workbook</button>
        <button class="btn" id="fitBtn" type="button">Fit</button>
        <button class="btn" id="layoutBtn" type="button">Auto layout</button>
        <button class="btn" id="expand1Btn" type="button" title="Show 1-hop neighbors">Expand 1-hop</button>
        <button class="btn" id="expand2Btn" type="button" title="Show 2-hop neighbors">Expand 2-hop</button>
        <button class="btn" id="hideIsolatedBtn" type="button">Hide isolated</button>
        <details class="dropdown" id="filters-dropdown">
          <summary>Filters</summary>
          <div class="menu">
            <label><input type="checkbox" data-filter="Field" checked /> Fields</label>
            <label><input type="checkbox" data-filter="CalculatedField" checked /> Calculated</label>
            <label><input type="checkbox" data-filter="Worksheet" checked /> Worksheets</label>
            <label><input type="checkbox" data-filter="Dashboard" checked /> Dashboards</label>
            <label><input type="checkbox" data-filter="Parameter" checked /> Parameters</label>
            <hr />
            <label><input type="checkbox" data-filter="lodOnly" /> LOD only</label>
            <label><input type="checkbox" data-filter="tableCalcOnly" /> Table Calcs only</label>
          </div>
        </details>
        <details class="dropdown" id="export-dropdown">
          <summary>Export</summary>
          <div class="menu">
            <button class="btn" type="button" data-export="workbook-json">workbook_doc.json</button>
            <button class="btn" type="button" data-export="graph-json">graph.json</button>
            <button class="btn" type="button" data-export="markdown">workbook_doc.md</button>
            <button class="btn" type="button" data-export="dot">lineage.dot</button>
          </div>
        </details>
      </div>
      <div class="toolbar-right">
        <button class="btn" id="theme-toggle" type="button" aria-pressed="true">Dark</button>
        <form id="search-form" role="search">
          <label for="search" class="visually-hidden">Search nodes</label>
          <input id="search" name="q" type="search" placeholder="Search..." list="node-names" autocomplete="off" />
          <datalist id="node-names"></datalist>
        </form>
      </div>
    </header>

    <main class="layout">
      <aside class="sidebar">
        <section id="dropZone" class="dropzone" aria-label="Workbook drop zone" tabindex="0">
          <input id="fileInput" type="file" accept=".twb,.twbx" hidden />
          <p>Drop a Tableau .twb or .twbx file here<br />or click Open Workbook.</p>
        </section>
        <nav class="tabs" aria-label="Sidebar tabs">
          <button type="button" data-tab="panel-nodes" class="tab active">Nodes</button>
          <button type="button" data-tab="panel-sheets" class="tab">Sheets</button>
          <button type="button" data-tab="panel-calcs" class="tab">Calcs</button>
          <button type="button" data-tab="panel-params" class="tab">Params</button>
        </nav>
        <section id="panel-nodes" class="tab-panel active" aria-live="polite">
          <ul id="list-nodes"></ul>
        </section>
        <section id="panel-sheets" class="tab-panel" aria-live="polite">
          <ul id="list-sheets"></ul>
        </section>
        <section id="panel-calcs" class="tab-panel" aria-live="polite">
          <ul id="list-calcs"></ul>
        </section>
        <section id="panel-params" class="tab-panel" aria-live="polite">
          <ul id="list-params"></ul>
        </section>
      </aside>

      <section class="graphwrap">
        <div id="graph" aria-label="Graph canvas"></div>
        <div id="status" class="status">No workbook loaded.</div>
      </section>

      <aside class="details" id="details" aria-live="polite">
        <h2>No selection</h2>
        <p>Load a workbook and choose a node to see details.</p>
      </aside>
    </main>

    <footer class="status-bar">
      <span id="status-text">Ready.</span>
      <span id="footer-info"></span>
    </footer>

    <div id="errOverlay"></div>

    <script src="./lib/jszip.min.js"></script>
    <script src="./lib/cytoscape.min.js"></script>
    <script src="./lib/cytoscape-cose-bilkent.min.js"></script> <!-- keep if present -->
    <script src="./app.js"></script>
  </body>
</html>
